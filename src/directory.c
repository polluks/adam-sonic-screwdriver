/**
 * @brief   Adam's Disk Sonic Screwdriver - a File and Disk Manager
 * @author  Thomas Cherryhomes
 * @email   thom dot cherryhomes at gmail dot com
 * @license gpl v. 3, see LICENSE for details.
 * @verbose Directory display
 */

#include <eos.h>
#include <msx.h>
#include <smartkeys.h>
#include <conio.h>
#include "directory.h"
#include "state.h"
#include "rleunpack.h"
#include "eos_filesystem.h"

extern State state;

char directory_files[32][16] =
  {
    "FILENAME 1",
    "FILENAME 2",
    "FILENAME 3",
    "FILENAME 4",
    "FILENAME 5",
    "FILENAME 6",
    "FILENAME 7",
    "FILENAME 8",
    "FILENAME 9",
    "FILENAME 10",
    "FILENAME 11",
    "FILENAME 12",
    "FILENAME 13",
    "FILENAME 14",
    "FILENAME 15",
    "FILENAME 16",
    "FILENAME 17",
    "FILENAME 18",
    "FILENAME 19",
    "FILENAME 20",
    "FILENAME 21",
    "FILENAME 22",
    "FILENAME 23",
    "FILENAME 24",
    "FILENAME 25",
    "FILENAME 26",
    "FILENAME 27",
    "FILENAME 28",
    "FILENAME 29",
    "FILENAME 30",
    "FILENAME 31",
    "FILENAME 32",
  };

// RLE encoded pixel data to go to VDP address 0x0000

unsigned char directory_pixels[] = {
  0x8e, 0x00, 0x02, 0x03, 0x07, 0x85, 0x00, 0x03, 0x01, 0x03, 0x07, 0xe4,
  0x00, 0x04, 0xf0, 0x07, 0x03, 0x01, 0xff, 0x00, 0x02, 0x00, 0x07, 0x97,
  0xf0, 0x04, 0x03, 0x02, 0x02, 0x03, 0x83, 0x02, 0x09, 0x00, 0x18, 0x02,
  0x02, 0xc2, 0x02, 0x02, 0x07, 0x00, 0x86, 0x20, 0x0b, 0xc1, 0x00, 0x07,
  0x80, 0x80, 0xf0, 0x80, 0x80, 0x07, 0x00, 0xf0, 0x85, 0x08, 0x03, 0xf0,
  0x00, 0x1c, 0x85, 0x88, 0x14, 0x1c, 0x00, 0x0c, 0x8a, 0x8a, 0x0c, 0xa2,
  0x92, 0x8b, 0x00, 0x18, 0x08, 0x08, 0xc8, 0x08, 0x08, 0x18, 0x00, 0xc1,
  0x88, 0x83, 0x08, 0x15, 0x88, 0x08, 0x00, 0x8c, 0x8a, 0x8a, 0x8b, 0x8a,
  0x8a, 0x8d, 0x00, 0xc8, 0x28, 0x25, 0xc2, 0x82, 0x42, 0x22, 0x00, 0x80,
  0x80, 0xff, 0x00, 0x8f, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x01,
  0x80, 0x87, 0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88,
  0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88,
  0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x98,
  0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff,
  0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9,
  0x00, 0x88, 0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88,
  0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88,
  0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x98,
  0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff,
  0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9,
  0x00, 0x88, 0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88,
  0xc0, 0x88, 0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88,
  0x00, 0x98, 0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x98,
  0xf0, 0xff, 0x00, 0xd9, 0x00, 0x88, 0xc0, 0x88, 0x00, 0x96, 0xf0, 0x02,
  0x07, 0x03, 0xff, 0x00, 0xd9, 0x00, 0x87, 0xc0, 0x01, 0x80, 0x88, 0x00,
  0x04, 0xf0, 0xf0, 0x07, 0x03, 0x84, 0x00, 0x02, 0x07, 0x03, 0xff, 0x00,
  0xc6, 0x00, 0x01, 0x01, 0x85, 0x00, 0x01, 0x01, 0x85, 0x00, 0x01, 0x01,
  0x85, 0x00, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0xff, 0x00, 0xff, 0x00,
  0xff, 0x00, 0xff, 0x00, 0xa4, 0x00
};

// RLE encoded color data to go to VDP address 0x2000

unsigned char directory_colors[] = {
  0x8e, 0x17, 0x02, 0xe7, 0xe7, 0x85, 0x17, 0x03, 0xf7, 0xfe, 0xfe, 0x84,
  0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84,
  0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84,
  0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84,
  0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84, 0x17, 0x84, 0x1f, 0x84,
  0x17, 0x01, 0xf7, 0x83, 0x7f, 0xff, 0x17, 0x03, 0x17, 0x17, 0x71, 0x86,
  0xe1, 0x88, 0x1e, 0x88, 0xef, 0x88, 0x1f, 0x01, 0xf1, 0x8d, 0x1f, 0x03,
  0xf1, 0x1f, 0xf1, 0x85, 0x1f, 0x03, 0xf1, 0x1f, 0xf1, 0x85, 0x1f, 0x01,
  0xf1, 0x89, 0x1f, 0x04, 0xf1, 0x1f, 0x1f, 0xf1, 0x84, 0x1f, 0x01, 0xf1,
  0x85, 0x1f, 0x03, 0xf1, 0x1f, 0xf1, 0x87, 0x1f, 0x01, 0xf1, 0x85, 0x1f,
  0x01, 0xf1, 0x99, 0x1f, 0xff, 0x17, 0x01, 0x17, 0x88, 0xe1, 0x88, 0x1e,
  0x88, 0xef, 0xff, 0x1f, 0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1,
  0x88, 0x1e, 0x88, 0xef, 0x98, 0x1f, 0xc8, 0x17, 0x90, 0x1f, 0xc8, 0x17,
  0xa0, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef,
  0xff, 0x1f, 0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e,
  0x88, 0xef, 0x98, 0x1f, 0xc8, 0x17, 0x90, 0x1f, 0xc8, 0x17, 0xa0, 0x1f,
  0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef, 0xff, 0x1f,
  0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef,
  0x98, 0x1f, 0xc8, 0x17, 0x90, 0x1f, 0xc8, 0x17, 0xa0, 0x1f, 0x88, 0xf7,
  0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef, 0xff, 0x1f, 0xd9, 0x1f,
  0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef, 0x98, 0x1f,
  0xc8, 0x17, 0x90, 0x1f, 0xc8, 0x17, 0xa0, 0x1f, 0x88, 0xf7, 0x88, 0x17,
  0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef, 0xff, 0x1f, 0xd9, 0x1f, 0x88, 0xf7,
  0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef, 0x98, 0x1f, 0xc8, 0x17,
  0x90, 0x1f, 0xc8, 0x17, 0xa0, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1,
  0x88, 0x1e, 0x88, 0xef, 0xff, 0x1f, 0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17,
  0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef, 0x98, 0x1f, 0xc8, 0x17, 0x90, 0x1f,
  0xc8, 0x17, 0xa0, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e,
  0x88, 0xef, 0xff, 0x1f, 0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1,
  0x88, 0x1e, 0x88, 0xef, 0x98, 0x1f, 0xc8, 0x17, 0x90, 0x1f, 0xc8, 0x17,
  0xa0, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef,
  0xff, 0x1f, 0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e,
  0x88, 0xef, 0x98, 0x1f, 0xc8, 0x17, 0x90, 0x1f, 0xc8, 0x17, 0xa0, 0x1f,
  0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x88, 0xef, 0xff, 0x1f,
  0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x88, 0xe1, 0x88, 0x1e, 0x86, 0xef,
  0x02, 0xfe, 0xfe, 0xff, 0x1f, 0xd9, 0x1f, 0x88, 0xf7, 0x88, 0x17, 0x02,
  0xe1, 0xe1, 0x84, 0x1e, 0x7f, 0x11, 0x11, 0xe1, 0xe1, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e,
  0x57, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11,
  0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11,
  0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11,
  0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11,
  0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11,
  0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x1e, 0x11, 0x11,
  0x1e, 0x1e, 0x11, 0x71, 0x1e, 0x1e, 0x11, 0x11, 0x1e, 0x7e, 0x17, 0x17,
  0x1e, 0x1e, 0x11, 0x71, 0x84, 0x17, 0x02, 0x1e, 0x7e, 0xff, 0x17, 0xff,
  0x17, 0xff, 0x17, 0xff, 0x17, 0xff, 0x17, 0xff, 0x17, 0xa4, 0x17
};

// Display current directory page in Directory

void directory_display(void)
{
  RLEUnpack(0x0000,directory_pixels,MODE2_MAX);
  RLEUnpack(0x2000,directory_colors,MODE2_MAX);

  for (int i=0;i<32;i++)
    {
      int r = i >> 1;
      int c = i % 2;
      int y = r + 3;
      int x = c ? 16 : 3;
      int b = r % 2 ? 0x0F : 0x07;
      
      msx_color(1,b,7);

      gotoxy(x,y);
      cputs(directory_files[i]);
    }

  state=HALT;
}

unsigned char buf[8192];

void directory(void)
{
  cprintf("EOS filesystem in 0x05? %u\n",is_eos_filesystem(0x04));
  state=HALT;
}
